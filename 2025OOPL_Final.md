# 2025 OOPL Final Report

## 組別資訊

組別：第十六組
組員：陳毅、蔡佳芠
復刻遊戲：osu!CatchTheBeat

## 專案簡介

### 遊戲簡介
    螢幕頂端會掉下許多水果，玩家需要操作角色接住從天而降的水果。通過鍵盤的左右方向鍵移動角色，按住Shift鍵可加速移動。
### 組別分工
陳毅：
    - 遊戲架構建設
    - 遊戲功能編寫
    - 讀取.ous檔案內容

蔡佳芠：
    - 遊戲功能編寫
    - 遊戲畫面、物件設計
    - 解讀.osu檔

## 遊戲介紹

### 遊戲規則
通過鍵盤的左右方向鍵移動角色，按住Shift鍵可加速移動，在畫面左上角的血條歸零之前接住所有水果。可按Esc鍵呼叫遊戲暫停選單。

### 遊戲畫面

## 程式設計

### 程式架構
狀態機 (State Machine)：App 以 enum class State { MENU, SELECT_LEVEL, GAME_UPDATE, END } 控制流程。
場景樹 (Scene Graph)：所有遊戲物件皆繼承 Util::GameObject，透過 m_Root 建立樹狀結構統一更新與渲染。
資源管理：使用 std::shared_ptr 與 RAII 管理 Image/BGM/SFX，避免記憶體外漏並支援熱重載。
輸入系統：Util::Input 封裝 GLFW 輸入，支援鍵盤、滑鼠游標與滾輪事件。
UI 元件：Button 類別封裝繪製、點擊判定與滾動邏輯，可動態生成關卡清單。
除錯模式 (Debug Mode)：按 F3 切換，顯示 FPS、Hitbox 與物件數量，有助於最佳化效能。

### 程式技術
語言／編譯：C++17 + CMake，IDE：JetBrains CLion 2025.1。
圖形：OpenGL 4.6、GLFW、GLAD、stb_image、GLM。
音訊：SFML Audio，支援 BGM 與 SFX 並行播放。
除錯：ImGui (內部工具)、Valgrind／Dr.Memory (偵測 Memory Leak)。
CI/CD：GitHub Actions 自動建構 Windows 可執行檔與 Release Artifact。

## 結語

### 問題與解決方法
1. 記憶體外漏
sol. 統一以 shared_ptr/weak_ptr 管理物件，並確保 RemoveChild() 時釋放資源

2. 重新開始遊戲後，音樂重播但水果不會重新落下
sol. 

3. 水果卡在空中不下落
sol. 調整 UpdateFruits() 流程，只有在 fruits 為空時才生成新水果，並檢查碰撞邏輯

4. 遊戲按鈕與物件在遊戲介面中畫質粗糙
sol. 

5. 遊戲結束後不會跳至結束畫面，會卡在遊戲介面並重播當前關卡音樂
sol. 

6. 嘗試載入.osu檔卻無法解讀檔案內容
sol. 上網爬.osu圖譜的相關資料、網站、影片，對照著其檔案內容推理與分析內容邏輯，但因為網路資料對於圖檔內容資料意義的相關資料並不夠清楚，於是先將手邊的資料詢問Chat GPT當前的理解是否正確，再將無法解讀的資料詢問GPT的看法。
　　　詳細理解後將理解的內容與變數意義整理成文檔、將解讀出的變數意義比對每行程式確認有無缺漏與可否成功解釋，經逐行確認大致無缺漏與錯誤後將文檔分享給組員。

7. 於選擇關卡時無法切換為白色按鈕
sol. 

8. 遊戲結束後重回選單，無法撥放背景音樂
sol. 因為背景音樂為遊戲開始後觸發，進行遊戲後會改為撥放關卡音樂，故在結束時State需重新將Play

9. 遊戲開始後，水果在背景音樂與關卡音樂切換之間掉落
sol. 在點選關卡時就將音樂Pause

10. 關卡選單無邊界滾動
sol. 在 SelectLevel::Update() 依中央按鈕索引限制滾動方向

11. 浮點誤差導致角色邊緣抖動：
sol. 在 Physics::Resolve() 加入 epsilon = 0.01f 並強制 Y 軸對齊平台表面


### 自評

| 項次 | 項目                   | 完成 |
|------|------------------------|-------|
|     | 顯示接水果的人物與食物 |  V  |
|     | 使人物移動、吃到食物分數增加 |  V  |
|     | Combo產生額外分數  |  V  |
|     | 當血量歸零時顯示失敗  |  V  |
|     | 遊玩結束後顯示結算畫面   |  V  |
|     | 解讀.osu檔並載入使用譜面  |  V  |
|     | 結算畫面顯示分數、等級、總接取、未接取、接取機率與最大combo數   |  V  |
|     | 使用滑鼠滾動檢視遊戲關卡  |  V  |
|     | 遊戲封面背景為隨機關卡背景   |  V  |
|     | 遊戲選單背景顯示當前選擇關卡背景   |  V  |
|     | 當前選擇關卡按鈕設為白色   |  V  |
|     |    |    |

### 心得
陳毅：

蔡佳芠：

### 貢獻比例
陳毅：
蔡佳芠：